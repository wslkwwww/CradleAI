# 记忆功能

## 基本概念

记忆功能是AI聊天体验的核心增强，它使AI能够记住与您的对话内容，提供更连贯、更个性化的交流体验。系统提供了两种记忆模式：向量记忆和表格记忆，它们协同工作以实现不同类型信息的存储和检索。

### 记忆类型

1. **向量记忆**：以事实形式存储对话中的关键信息
   - 自动提取并记录对话中的重要事实
   - 使用语义理解技术，根据上下文关联性检索相关记忆

2. **表格记忆**：以结构化形式组织信息
   - 将特定类型的信息（如人物关系、事件时间线等）存储在表格中
   - 便于AI系统性地了解和引用复杂信息

3. **对话总结**：定期对长对话进行摘要
   - 自动或手动触发，生成对话内容的精炼总结
   - 帮助AI保持对长期对话主题和发展的理解

## 记忆面板

在聊天界面中，您可以点击右上角的"记忆"图标打开记忆管理面板。这个面板提供了查看和管理AI记忆的所有功能。

### 对话总结标签页

此标签页展示了系统为当前对话生成的所有总结内容。

1. **查看总结**：所有自动或手动生成的对话总结按时间顺序显示
   - 每个总结包含创建时间和覆盖的对话范围信息
   - 点击总结可展开查看完整内容

2. **生成总结**：手动触发对话总结生成
   - 点击"立即生成对话总结"按钮
   - 系统会分析当前对话内容，生成一份新的总结
   - 适用于重要对话节点或情节转折点

3. **删除总结**：点击总结右侧的删除图标可移除不需要的总结

### 表格标签页

此标签页显示并管理当前角色的所有结构化记忆表格。

1. **表格选择**：点击上方的表格标签可切换不同表格
   - 系统根据对话内容自动填充和更新表格
   - 每个表格针对特定类型的信息（如人物信息、关系网络等）

2. **编辑表格**：
   - 点击任意单元格进行编辑
   - 点击"添加行"按钮新增表格行
   - 点击行末尾的删除图标可删除整行

3. **表格操作**：
   - 点击表格标签旁的刷新按钮更新表格视图
   - 点击表格标签旁的删除图标可移除整个表格

### 事实标签页

此标签页展示系统自动记录的所有事实记忆。

1. **浏览记忆**：
   - 所有记忆按时间顺序显示，最新的记忆在前
   - 点击记忆条目可展开查看详细信息，包括创建时间和关联数据

2. **搜索记忆**：
   - 使用上方搜索框查找特定记忆
   - 输入关键词后按回车或点击搜索图标进行搜索

3. **管理记忆**：
   - **添加记忆**：点击右上角"+"按钮手动添加新记忆
   - **编辑记忆**：展开记忆后点击"编辑"按钮修改内容
   - **删除记忆**：展开记忆后点击"删除"按钮移除不需要的记忆

4. **备份与恢复**：
   - **导出记忆**：点击底部"导出记忆"按钮将所有记忆保存到文件
   - **导入记忆**：点击底部"导入记忆"按钮从文件恢复之前导出的记忆

### 设置标签页

此标签页提供记忆系统的所有配置选项。

1. **表格模板管理**：
   - 选择要使用的表格模板类型
   - 点击"创建表格"按钮根据选定模板生成新表格
   - 系统会自动根据模板结构创建并初始化表格

2. **向量记忆系统**：
   - **启用记忆功能**：开启或关闭记忆记录功能
   - **记忆处理间隔**：设置每隔多少轮用户消息处理一次记忆（1-20轮）

3. **表格记忆插件**：
   - **启用表格记忆**：开启或关闭表格形式的结构化记忆功能

4. **表格维护**：对选中的表格进行维护操作
   - 提供多种表格重建和修复选项，用于解决数据不一致问题
   - 常用选项包括"重建表格"、"修复表格数据"和"简化历史记录"

## 最佳实践

### 高效使用记忆功能

1. **适度设置记忆处理间隔**：
   - 对于日常闲聊，可设置较大间隔（10-20轮）减少资源消耗
   - 对于重要信息密集的对话，设置较小间隔（1-5轮）确保及时记录

2. **定期生成对话总结**：
   - 在重要对话节点后手动触发对话总结
   - 有助于AI理解长期对话脉络，提高响应质量

3. **选择合适的表格模板**：
   - 根据角色特性和对话主题选择相关表格模板
   - 例如，对于虚构角色可选择"角色背景"和"人际关系"模板
   - 对于辅导类角色可选择"学习进度"和"知识点"模板

4. **平衡记忆数量**：
   - 定期检查和清理不再相关的记忆
   - 过多记忆可能导致系统变慢或响应混乱

### 故障排除

1. **表格未更新**：
   - 尝试点击刷新按钮手动更新表格视图
   - 如仍无效，可在设置标签页使用"重建表格"功能

2. **记忆搜索无结果**：
   - 尝试使用更简短、更一般的关键词
   - 确认记忆功能已开启并正常工作

3. **无法添加新记忆**：
   - 确认已在设置中配置了有效的API密钥
   - 检查网络连接是否正常

4. **记忆内容不准确**：
   - 使用编辑功能修正错误记忆
   - 对于表格记忆，可直接编辑相关单元格内容

## 高级功能

### 记忆备份与迁移

记忆导出和导入功能允许您将角色的记忆转移到其他设备，或在角色之间共享记忆：

1. **导出记忆**：
   - 在事实标签页底部点击"导出记忆"
   - 系统将生成包含所有记忆的JSON文件
   - 文件可保存到设备或分享给其他应用

2. **导入记忆**：
   - 在事实标签页底部点击"导入记忆"
   - 选择之前导出的记忆JSON文件
   - 确认导入目标角色（可以是同一角色或不同角色）

### 表格记忆定制

高级用户可以通过设置标签页中的维护选项对表格记忆进行定制：

1. **重建表格**：根据对话历史重新构建表格内容
   - 基础重建：使用基本提示重建表格
   - 兼容重建：保留原有结构的同时更新内容
   - 摘要重建：生成更简洁的表格内容

2. **修复与简化**：
   - 修复表格数据：修正表格中的不一致或错误
   - 简化历史记录：精简冗余信息，保留核心内容

## 常见问题

1. **记忆功能会消耗多少资源？**  
   记忆功能会使用API调用和本地存储空间。向量记忆数据库超过50MB时会显示警告，建议定期清理不必要的记忆。

2. **如何确定哪些信息会被记住？**  
   系统会自动识别重要信息，如个人偏好、重要事件、关系变化等。您也可以通过手动添加记忆来确保特定信息被记录。

3. **为什么有时AI似乎忘记了之前提到的内容？**  
   这可能是因为：
   - 相关记忆没有被检索到（尝试提供更明确的上下文）
   - 记忆处理间隔设置过大（尝试减小间隔值）
   - 特定信息未被系统判定为重要（考虑手动添加记忆）

4. **记忆与自设有什么区别？**  
   自设是您提供给AI的静态角色设定，不会随对话变化；而记忆是动态的，会随着对话不断积累和更新。两者配合使用效果最佳。

5. **如何防止重要记忆被忘记？**  
   对于特别重要的信息，建议：
   - 手动添加为事实记忆
   - 在表格中记录
   - 定期生成对话总结以巩固长期记忆

6. **为什么表格内容与对话不完全匹配？**  
   表格内容由AI根据对话内容提取和推断生成，可能存在理解偏差。您可以随时手动编辑表格内容进行修正。
